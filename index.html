<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Trending</title>
<script language="javascript" type="text/javascript" src="server.js"></script>
<script type="text/javascript"
  src="https://maps.googleapis.com/maps/api/js?libraries=visualization&sensor=true_or_false">
</script>
<link href='http://fonts.googleapis.com/css?family=Crete+Round' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Roboto:300,500' rel='stylesheet' type='text/css'>
<style>
  html, body, #map-canvas {
      height: 100%;
      margin: 0px;
      padding: 0px;
      overflow: hidden;
      font-family: 'Roboto';
      font-weight: 300;
      color: #fff;
  }
  #sidebar {
      text-align: center;
      font-size:18px;
      position: relative;
      background-color: #439ed1;
      width: 25%;
      height: 100%;
      float: right;
      top: 0;
      bottom:0;
      overflow-x: hidden;
      padding:1.5em;
      letter-spacing: 0.5px;
  }
  #header {
    padding-top:0.5em;
    padding-bottom:0.5em;
    width: 62%;
    margin: 0 auto;
  }
  #markers {
    padding-left:1em;
    padding-top:2em;
    padding-bottom:2em;
    text-align:left;
    font-weight:500;
  }
  #panel {
      position: absolute;
      top: 5px;
      left: 50%;
      margin-left: -180px;
      z-index: 5;
      background-color: #fff;
      padding: 5px;
      border: 1px solid #999;
  }
  .relative{
    position:relative;
    overflow-x:hidden;
  }
  h1{font-size:21px;}

  .styled-select select {
     width: 268px;
     padding: 5px;
     font-size: 16px;
     line-height: 1;
     border: 0;
     border-radius: 4px;
     height: 40px;
     margin: 10px 0px;
  }

  .fullwidth {
    margin: 10px 0px;
    width: 70%;
  }

  .rangeslider {
    margin-top: 2em;
  }

  .logo-box {
    margin-top:1em;
    border-width: 4px;
    border-style: solid;
    border-color: #fff;
    height: 60px;
    width: 280px;
    margin-left: 3%;
    padding-bottom: 10px;
  }

  .logo-text {

    font-family: 'Crete Round', serif;
    font-size: 50px;
    color: #fff;
    text-align: center;
  }

</style>

<script>

var request = new XMLHttpRequest();

request.open("GET","/api/checkin/",true);
request.send();

var busData = [];
// keys: name, addr, rvwCt, chkCt, hours, stars, tags, coords

var heatmapData = [];
var highestChkCt = 0;
var mapCenter;
var timeRange;

request.onreadystatechange = function() {
    if (request.readyState == 4 && (request.status == 200)) {
        var data = JSON.parse(request.responseText);
        busData = data;
        map = new google.maps.Map(document.getElementById("map-canvas"), {
          center: new google.maps.LatLng(36.109805026680903, -115.174355506897),
          zoom: 14,
          mapTypeId: google.maps.MapTypeId.MAP
        });
        for (var i=0; i < data.length - 1; i++) {
            var point = {};
            var coords = data[i]["coords"];
            var weight = data[i]["chkCt"] + data[i]["rvwCt"];
            if (weight > highestChkCt) {
                highestChkCt = weight;
                mapCenter = coords;
            }
            point["weight"] = weight;
            point["location"] = new google.maps.LatLng(coords[0], coords[1]);
            if (weight > 5000) {

              var contentString = data[i]["name"];
              var infowindow = new google.maps.InfoWindow({
                content: contentString
              })
              var marker = new google.maps.Marker({
                position: new google.maps.LatLng(coords[0], coords[1]),
                map: map,
                title: data[i]["name"]
              })  
              google.maps.event.addListener(marker, 'click', function() {
                infowindow.open(map,marker);
              });
            }
            heatmapData.push(point);
        }
        var heatmap = new google.maps.visualization.HeatmapLayer({
          data: heatmapData
        });
        heatmap.setMap(map);
        heatmap.set("radius", 25);
        heatmap.set("opacity", 0.7);
        heatmap.set("maxIntensity", 10000);
    }
}


var request1 = new XMLHttpRequest();

request1.open("GET","/api/checktime/",true);
request1.send();

var checkData;

request1.onreadystatechange = function() {
    if (request.readyState == 4 && (request.status == 200)) {
        var data = JSON.parse(request.responseText);
        checkData = data;
    }
}


function showValue(newValue) {
  document.getElementById("range").innerHTML=newValue;
  timeRange = newValue;
}



</script>

</head>
<body>
<!-- <div id="panel">
    <button onclick="toggleHeatmap()">Toggle Heatmap</button>
    <button onclick="changeGradient()">Change gradient</button>
    <button onclick="changeRadius()">Change radius</button>
    <button onclick="changeOpacity()">Change opacity</button>
</div> -->
<div id="sidebar">
    <div id="header">
      <div class="logo-box">
        <div class="logo-text">
          trending
        </div>
      </div>
    </div>
    <div id="markers">
      <b>Filter markers by:</b>
    </div>

    Day of the week:
    <div class="styled-select">
      <select class="filterby">
        <option value="1">Sunday</option>
        <option value="2">Monday</option>
        <option value="3">Tuesday</option>
        <option value="4">Wednesday</option>
        <option value="5">Thursday</option>
        <option value="6">Friday</option>
        <option value="7">Saturday</option>
      </select>
    </div>
    <div class = "rangeslider">
      <span class="range-select">Universal time selector:</span><br>
      <input type="range" class = "fullwidth" min="0" max="23" value="12" step="1" onchange="showValue(this.value)" />
      <br>
      <span id="range">12</span>
    </div>
</div>
<div id="map-canvas" class="relative"></div>
</body>
</html>
